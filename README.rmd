---
title: "2016-0509 MSDS 6304-401 Case Study"
author: "Bill Kerneckel"
date: "June 19, 2016"
output:
  html_document:
    keep_md: yes
---

<br>

#### Introduction


Gross Domestic Product (GDP) is the term used to by the workd to measure in dollars the values of goods and serivces produced by a country in a certain timeframe, usually by annual year. The GDP is the measurement used as a indicator to gauge the financial health and strength of the countries economy. In 2014, the World Bank collected 214 countries GPD. The economy coverage of this data spreads across the World, East Asia & Pacific, Europe & Central Asia, Latin America & Caribbean, Middle East & North Africa, South Asia, Sub Saharan Africa. The data includes high, middle, low incomes, and both Intertnational Development Association (IDA) and International Bank for Reconstruction and Development (IBRD) data. To view more details on this particular data set visit: <a href="http://data.worldbank.org/data-catalog/GDP-ranking-table" target="blank">The World Bank GDP Ranking</a>

Along with the GDP, The World Bank "EdStats All Indicator Query" holds around 3,000 internationally comparable indicators that describe education access, progression, completion, literacy, teachers, population, and expenditures. The indicators cover the education cycle from pre-primary to vocational and tertiary education. (source: <a href="http://http://data.worldbank.org/data-catalog/ed-stats">http://http://data.worldbank.org/data-catalog/ed-stats</a>)

In this study we will evaluate 190 ranked countries GPD and merge with education indicator data generated by the "EdStats All Indicator Query" to anwser the following questions:

1. Match the data based on the country shortcode. How many of the IDs match?
2. Sort the data frame in ascending order by GDP rank (so United States is last). What is the
13th country in the resulting data frame?
3. What are the average GDP rankings for the "High income: OECD" and "High income:
nonOECD" groups?
4. Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group.
5. Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group.
How many countries are Lower middle income but among the 38 nations with highest
GDP?


****************************

#### Setting your working directory

In order for the analysis, tidying, and merging of two datasets you must set your working directory to the following:

`````
setwd("/Users/YOURUSERNAMESGOESHERE/desktop/CaseStudy/")
`````

****************************

#### Required Libraries for this Case Study

The libraries listed below must be installed in order for the functions outlined in the steps below to execute.

```{r  message=FALSE, warning=FALSE }
library(downloader)
library(tidyr)
library(dplyr)
library(data.table)
library(RCurl)
library(ggplot2)
library(repmis)
library(scales)

cat("Success: All libaries downloaded")
```

****************************

#### Data Gathering

Both datasets are downloaded from <a href="https://d396qusza40orc.cloudfront.net/" target="blank">Cloudfront.net</a>.

```{r}
download("https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FGDP.csv", destfile="GDP.csv")
download("https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2FEDSTATS_Country.csv", destfile="FEDSTATS_Country.csv")

cat("Data downloaded into current working directory")
```

****************************


#### Analysis of both data sets

Rough analysis of the datasets. The GDP.csv dataframe has 330 observations of 10 variables and the Fedstats_country.csv dataframe has 235 observations of 31 variables. Below are the details of both dataset:

GDP.csv

```{r}
gdp_data <- read.csv("GDP.csv", stringsAsFactors=FALSE, header=FALSE)
dim(gdp_data)
str(gdp_data)
```

Fedstats_country.csv

```{r}
fedstats_data <- read.csv("Fedstats_country.csv", stringsAsFactors=FALSE, header=FALSE)
dim(fedstats_data)
str(fedstats_data)
```

****************************


#### Tidy the data for GPD.csv data set

Here are the steps I have outlined to clean up the gross dosmestic product (GDP) data contained in the GDP.csv file. The steps below are required to merge the data:
<br>
<br>

<strong>Step 1:</strong> First we need to look at the first 10 records and last 10 records. This will help us understand what type of data exists in the data set.

```{r}
head(gdp_data,10)
tail(gdp_data,10)
```

<br>

<strong>Step 2:</strong> So the data is actually between rows 5 and 330. Since the assignment states we will only be looking at the 190 countries we can omit and data greater than 190. So lets set the rows between 5 and 194. You may be asking the question why I didn't I set the rows to 190. Well we need to account for extra rows added in the heading off the data file.

```{r}
gpd_data <- gdp_data[6:195,]
```
<br>

<strong>Step 3:</strong> Notice all the 'NA's in the data set? Let's count how many there are before we remove them. From the output below there are a count of 331 NA's in each of the following columns: V3, V7, V8, V9, V10. If we add the numbers we have a total of 1,655 NAs in the GDP.csv dataset.

```{r}
na_count <-sapply(gdp_data, function(y) sum(length(which(is.na(y)))))
na_count <- data.frame(na_count)
na_count
```

<br>

<strong>Step 4:</strong> Now we need to remove the columns that have contain all "NA"s.

```{r}
na_removed <- gpd_data[,-which(apply(gpd_data,2,function(x)all(is.na(x))))]
```

<br>
<strong>Step 5:</strong> The data is getting more tidy, but I see one extra column we need to take care of. Notice the last column V6, let's see what data exists in the column before we decide what to do with it.

```{r}
levels(na_removed$V6)
occurances <- table(gpd_data$V6)
occurances
```

<br>

<strong>Step 6:</strong> The data in the V6 column does not appear to be useful so lets go ahead and remove the column from the dataset.

```{r}
na_removed$V6 <- NULL
clean_gdp_data <- na_removed
```

<br>

<strong>Step 7:</strong> Now we can rename the column headings to describe the data contain in each column. An important note here is the first column has to be renamed to the exact name as the first #column in the Fedstats_country.csv dataset. This is the column we will be merging with.

```{r}
setnames(clean_gdp_data, old=c("V1","V2","V4","V5"), new=c("CountryCode","Ranking","Country","Income"))
```

<br>

<strong>Step 8:</strong> We need to remove all commas "," from the numeric values in Income column.

```{r}
clean_gdp_data$Income <- gsub(",", "", clean_gdp_data$Income)
``` 

<br>
<strong>Step 9:</strong> We are almost finished with the tidying. We need to change the column type for the Ranking and Income columns from character to interger.

```{r}
clean_gdp_data$Income <- as.integer(clean_gdp_data$Income)
clean_gdp_data$Ranking <- as.integer(clean_gdp_data$Ranking)
```

Ok, finally we now have a tidy dataset for the GDP.csv. Remember this variable, <strong>clean_gdp_data</strong>, we will be using it later when we merge the data together. Next step is to tidy the next data set contained in the Fedstas_country.csv file.
<br>

****************************

#### Tidy the Data for Fedstats_country.csv data set

On to the next data set. Like the previous 9 steps above, I have again outlined steps below to clean up the data contained in the Fedstats_country.csv file. These steps are required in order to merge the data:
<br>
<br>

<strong>Step 1:</strong> First let's clean it up a bit and look at the first 52 records and last 2 records. This will help understand what type of data we are dealing with.

```{r}
head(fedstats_data,2)
tail(fedstats_data,2)
```
<br>

<strong>Step 2:</strong> So the data is actually starts on the 2 row. Let's go ahead and grab the data that we need.

```{r}
fedstats_data <- fedstats_data[2:235,]
```
<br>

<strong>Step 3:</strong> Wow, there is a lot of columns with data we donâ€™t need. Lets focus only focus on the columns we need so lets keep those.

```{r}
keep <- c("V1","V3")
clean_fedstats_data = fedstats_data[keep]
```
<br>

<strong>Step 4:</strong> Now lets remove the rows that contain blank values "Income.Group" column

```{r}
clean_fedstats_data <- subset(clean_fedstats_data, V3 != "")
```
<br>
<strong>Step 5:</strong> The data is almost tidy, but we have one last step, need to rename the column headings to words that describe the data in each of the columns.

```{r}
setnames(clean_fedstats_data, old=c("V1","V3"), new=c("CountryCode","Income_Category"))
```

<br>
Ok, finally we now have a tidy dataset for the Fedstats_country.csv. The variable name we ended up calling the tidy data for this dataset is called <strong>"clean_fedstats_data"</strong>. Now that we have both of our datasets tidy we can merge them together.
<br>

****************************

#### Merging the Data

Merging datasets in the two files together is tricky. We can only hope for a "one to one" relationship in the datasets so the merging goes smoothly. In this example, we want to merge the data from the combined datasets so the tidy data in the GDP country ranking data contained in the GPD.csv file is merged with the tidy data from the country code and education catagory data contained in the Fedstats_country.csv file. The column we want to merge on is the CountryCode column in both .CSV files.
<br>

<strong>Merge Data</strong>
```{r}
merged_data <- merge(clean_gdp_data, clean_fedstats_data, by="CountryCode", all=TRUE)
```

Now that we have merged the two datasets together lets take a look at we accomplished.

```{r}
str(merged_data)
```

Clearly we still have some more cleaning up to do. We need to remove all rows that contain blanks and NAs values in the columns.

```{r}
blanked_removed <- subset(merged_data, Income_Category != "")
na_removed <- subset(blanked_removed, Income != "NA")
```

Yahoo!!!! We have a clean merging of data. To conserve page real estate lets just ouptut the first 5 and last 5 records of the merged data.

```{r}
clean_merged_data <- na_removed
head(clean_merged_data,5)
tail(clean_merged_data,5)
```
****************************

#### Case Study Questions and Anwsers

<strong>Question 1.</strong> Match the data based on the country shortcode. How many of the IDs match? Before the merge of the two datasets we had 190 observations in the GPD.csv file. In the Fedstats_country.csv file we had a total of 211 observations.<strong>When we tidy up the data (removed the columns, NA's, blanks values in the datasets and merged on the country shortcake 189 observations matched.</strong>

<br>

<strong>Question 2.</strong> Sort the data frame in ascending order by GDP rank (so United States is last). What is the
13th country in the resulting data frame?

```{r}
arranged_data <- arrange(clean_merged_data, desc(Ranking))
thirteenthcountry <- arranged_data[13,]
thirteenthcountry
```
<br>

<strong>Question 3.</strong> What are the average GDP rankings for the "High income: OECD" and "High income:
nonOECD" groups?

Let's first arrange the data by Income Category

```{r}
arranged_by_category_data <- arrange(clean_merged_data, desc(Income_Category))
```

If we look at the starting rows and ending rows for the High income: OECD and High income: nonOECD groups in the "arranged_by_category_data" we can look at the summary to calculate the average of the ratings.

```{r}
High_Income_OECD <- arranged_by_category_data[137:166,]
summary(High_Income_OECD)
```

The average ranking for the High income: OECD is <strong>32.97</strong>


```{r}
High_Income_NonOECD <- arranged_by_category_data[167:189,]
summary(High_Income_NonOECD)
```

The average ranking for the High income: nonOECD is <strong>91.91</strong>

<br>

<strong>Question 4.</strong> Plot the GDP for all of the countries. Use ggplot2 to color your plot by Income Group.

```{r echo = FALSE, message=FALSE, warning=FALSE, error=FALSE,fig.width=16, fig.height=6}

arranged_data_income <- arrange(clean_merged_data, Income)

p <- ggplot(arranged_data_income, aes(reorder(CountryCode, Income), Income))

final <- p + aes(shape = factor(Income_Category)) + geom_point(aes(colour = factor(Income_Category)), size = 4) + geom_point(colour="grey90", size = 1.5) + geom_point() + theme(axis.text.x = element_blank()) + scale_y_log10(labels = NULL)

final
```

<br>

<strong>Question 5.</strong> Cut the GDP ranking into 5 separate quantile groups. Make a table versus Income.Group.


Ranking quantiles by applying the summary function.
```{R}
summary(arranged_by_category_data)
```

The quantiles are: <strong>1, 48, 95.31, 143, 190</strong>

<br>

<strong>1st Quantile (Low Income)</strong>

Now let's evaluate the data that exists in the first quantile (Low Income).

```{R}
FirstQuantile <- arranged_by_category_data[100:134,]
```

Grab the data from the columns we are only interested in.

```{R}
FirstQuantile2 <- FirstQuantile[ c("CountryCode", "Ranking", "Income_Category")]
```

Finally, we can sort the data in decending order by Income_Category.

```{R}
FirstQuantileIncome <- arrange(FirstQuantile2, desc(Income_Category))
FirstQuantileIncome
```

<br>

<strong>2nd Quantile (Lower Middle Income)</strong>

We will repeat the same data tidying metohds for the remaining qauntiles

```{R}
SecondQuantile <- arranged_by_category_data[46:99,]

SecondQuantile2 <- SecondQuantile[c("CountryCode", "Ranking", "Income_Category")]

SecondQuantileIncome <- arrange(SecondQuantile2, desc(Income_Category))
SecondQuantileIncome
```

<br>

<strong>3rd Quantile (Upper Middle Income)</strong>

```{r}
ThirdQuantile <- arranged_by_category_data[1:45,]

ThirdQuantile2 <- ThirdQuantile[c("CountryCode", "Ranking", "Income_Category")] 

ThirdQuantileIncome <- arrange(ThirdQuantile2, desc(Income_Category))
ThirdQuantileIncome
```

<br>

<strong>4th Quantile (High Income: nonOECD)</strong>

```{r}
FourthQuantile <- arranged_by_category_data[167:189, ]

FourthQuantile2 <- FourthQuantile[c("CountryCode", "Ranking", "Income_Category")]

FourthQuantileIncome <- arrange(FourthQuantile2, desc(Income_Category))
FourthQuantileIncome
```

<br>

<strong>5th Quantile (High Income: OECD)</strong>

```{r}
FifthQuantile <- arranged_by_category_data[137:166, ]

FifthQuantile2 <- FifthQuantile[c("CountryCode", "Ranking", "Income_Category")]

FifthQuantileIncome <- arrange(FifthQuantile2, desc(Income_Category)) 
FifthQuantileIncome
```

How many countries are lower middle income but have the top 38 highest GDP? <strong>49 countries have lower middle income but have the top 38 highest GDP. </strong>

```{r}
SecondQuantileIncome_Arranged <- arrange(SecondQuantileIncome, desc(Ranking))
SecondQuantileIncome_Arranged[1:49,]
```

Look at the "Lower Middle Income" entries and see which ones exist below the 38th GDP ranking. <strong>4 countries exist below the 38th GDP Ranking.</strong>

```{r}
SecondQuantileIncome_Arranged[51:54,]
```


****************************

#### Conclusion and Summary

In summary we downloaded, analyzed, tidy, and merged two .CSV files into one dataset. In order to merge the two files we first had to tidy the data in each dataset by removing unnecessary columns, removing NA and blank values, renaming column headings, and changing column types from factors to integers. As a result, before the merge of the data in the GPD.csv dataset we ended up with 189 records with 3 columns. In the Fedstats_country.csv the data frame has 235 observations of 31 variables. After we merged the dataset together and tidy up the data we ended up with 189 records. When we plotted the merged data we can clearly linear trend from lowest to highest GPD incomes. Clearly, the United States by far has the strongest GDP amoungst all the countries represented in the merged dataset. 


****************************

#### Acknowledgements

As per the terms of use on <a href="http://data.worldbank.org/summary-terms-of-use" target="blank">The World Bank GDP Ranking</a> I am acknowledging the source of the data in order to be able to freely use it.

